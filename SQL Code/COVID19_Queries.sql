
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- HIGHEST VACCINATED STATES
SELECT state,Administered_Dose1_Pop_Pct AS max_percent FROM covid_master_table
WHERE date = '2023-05-10' AND Administered_Dose1_Pop_Pct = 95
GROUP BY state
ORDER BY max_percent 
DESC LIMIT 1,8;
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------


-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- LOWEST VACCINATED STATES 
SELECT state, MAX(Administered_Dose1_Pop_Pct) AS max_percent FROM covid_master_table
WHERE date = '2023-05-10' 
GROUP BY state
ORDER BY max_percent 
LIMIT 6;
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
    
    
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- VACCINATION TRENDS 
WITH va_first_vax AS (
    SELECT MIN(Date) AS first_date
    FROM cdc_vaccinations_raw
    WHERE Location = 'VA'
      AND Administered_Dose1_Pop_Pct > 0
)
SELECT 
    Date,
    Location,
    Administered_Dose1_Pop_Pct
FROM cdc_vaccinations_raw, va_first_vax
WHERE
    (Location <> 'VA')
    OR (Location = 'VA' AND Date >= va_first_vax.first_date AND Administered_Dose1_Pop_Pct > 0)
ORDER BY Administered_Dose1_Pop_Pct DESC
LIMIT 100000 OFFSET 0;
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------




-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- STATE POLITICAL AFFILIATIONS AND VAX RATES 
SELECT p.Dem_or_rep, AVG(c.Administered_Dose1_Pop_Pct) AS average_vax_rate
FROM covid_master_table c
JOIN state_politics_raw p ON c.state = p.state
GROUP BY p.Dem_or_rep;
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------



-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- VACCINE HESITANCY VS ADMINISTRATION RATES
SELECT a.State, AVG(a.Estimated_hesitant) AS avg_hesitant, MAX(c.Administered_Dose1_Pop_Pct) AS max_vax_rate
FROM antivax_sentiment_raw a
JOIN covid_master_table c ON a.State = c.State
GROUP BY a.State
ORDER BY avg_hesitant DESC;
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------



-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- POLITICAL AFFILIATION AND VACCINATION HESITANCY
SELECT a.State, p.Dem_or_rep, AVG(a.Estimated_hesitant) AS avg_hestiant, AVG(a.Estimated_strongly_hesitant) AS avg_strongly_hesitant
FROM antivax_sentiment_raw a
JOIN state_politics_raw p ON a.State = p.State
GROUP BY a.State, p.Dem_or_rep
ORDER BY p.Dem_or_rep, a.State;
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------





-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- VACCINE ADMINISTRATION RATES VS HOSPITALIZATIONS
SELECT 
	state, 
    MAX(administered_Dose1_Pop_Pct) AS max_vax_rate, 
    AVG(total_adult_patients_hospitalized_confirmed_covid) AS covid_hospitalizations
FROM covid_master_table
GROUP BY state
ORDER BY covid_hospitalizations DESC;
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------



-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- VACCINE ADMINISTRATION  RATES VS ICU ADMITTANCE 
SELECT 
	state, 
    MAX(administered_Dose1_Pop_Pct) AS max_vax_rate, 
    AVG(adult_icu_bed_covid_utilization) AS icu_utilization
FROM covid_master_table
GROUP BY state
ORDER BY icu_utilization DESC;
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------



-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- VACCINE HESITANCY AND RED VS BLUE STATES
SELECT p.Dem_or_rep,
		c.state,
       AVG(a.Estimated_hesitant) AS avg_hesitant,
       AVG(a.Estimated_strongly_hesitant) AS avg_strongly_hesitant,
		AVG(c.administered_Dose1_Pop_Pct) AS avg_dose1_received
FROM antivax_sentiment_raw a
JOIN state_politics_raw p ON a.State = p.State
JOIN covid_master_table c ON c.state = a.State
GROUP BY p.Dem_or_rep, c.state;
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------





-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- VACCINATION RATES VS HOSPITALIZATIONS PER POPULATION 
-- better query than above use this one.
SELECT 
    a.State,
    MAX(c.administered_Dose1_Pop_Pct) AS max_vax_rate,
    SUM(c.total_adult_patients_hospitalized_confirmed_covid) / po.POPESTIMATE2021 AS relative_hospitalizations
FROM antivax_sentiment_raw a
JOIN population_raw po 
    ON po.NAME = a.State
JOIN covid_master_table c 
    ON c.state = a.State
WHERE c.date >= '2021-01-01'  -- filter to post-vaccine release
GROUP BY a.State, po.POPESTIMATE2021
ORDER BY max_vax_rate DESC;
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------



-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- VACCINATION RATES VS ICU ADMITTANCE PER POPULATION 
-- better query
SELECT 
    a.State,
    MAX(c.administered_Dose1_Pop_Pct) AS max_vax_rate,
    SUM(c.adult_icu_bed_covid_utilization) / po.POPESTIMATE2021 AS relative_icu_utilization
FROM antivax_sentiment_raw a
JOIN population_raw po 
    ON po.NAME = a.State
JOIN covid_master_table c 
    ON c.state = a.State
WHERE c.date >= '2021-01-01'  -- filter to post-vaccine release
GROUP BY a.State, po.POPESTIMATE2021
ORDER BY max_vax_rate DESC;
-- vaccinations vs icu utilization
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------


-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- VACCINE HESITANCY VS DEATHS
SELECT 
    a.State,
    AVG(a.Estimated_hesitant) AS avg_hesitant,
    MAX(c.deaths_covid) / po.POPESTIMATE2021 * 100 AS percent_population_dead_post_vax
FROM antivax_sentiment_raw a
JOIN population_raw po 
    ON po.NAME = a.State
JOIN covid_master_table c 
    ON c.state = a.State
WHERE c.date >= '2021-01-01'  -- only consider deaths after vaccine rollout
GROUP BY a.State, po.POPESTIMATE2021
ORDER BY avg_hesitant DESC;
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------




-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- VACCINATIONS VS DEATHS 
SELECT 
    c.state,
    MAX(c.administered_Dose1_Pop_Pct) AS max_vax_rate,
    SUM(c.deaths_covid) / po.POPESTIMATE2021 * 100 AS percent_population_dead_post_vax
FROM covid_master_table c
JOIN population_raw po 
    ON po.NAME = c.state
WHERE c.date >= '2021-01-01'  -- only consider deaths after vaccine rollout
GROUP BY c.state, po.POPESTIMATE2021
ORDER BY max_vax_rate DESC;
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------







-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- VACCINE ADMINISTRATION RATES, HOSPITALIZATIONS FOR THE 10 STATES OF INTEREST
SELECT 
    a.State,
    MAX(c.administered_Dose1_Pop_Pct) AS max_vax_rate,
    SUM(c.total_adult_patients_hospitalized_confirmed_covid) / po.POPESTIMATE2021 AS relative_hospitalizations
FROM antivax_sentiment_raw a
JOIN population_raw po 
    ON po.NAME = a.State
JOIN covid_master_table c 
    ON c.state = a.State
WHERE c.date >= '2021-01-01'  -- filter to post-vaccine release
	AND a.State IN ('WY', 'MS', 'LA', 'ID', 'TN', 'CT', 'MA', 'ME', 'RI', 'VT')
GROUP BY a.State, po.POPESTIMATE2021
ORDER BY max_vax_rate DESC;
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------





-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- VACCINE ADMINISTRATION RATES, ICU ADMITTANCE FOR THE 10 STATES OF INTEREST
SELECT 
    a.State,
	p.Dem_or_rep,
    MAX(c.administered_Dose1_Pop_Pct) AS max_vax_rate,
    SUM(c.adult_icu_bed_covid_utilization) / po.POPESTIMATE2021 AS relative_icu_utilization
FROM antivax_sentiment_raw a
JOIN state_politics_raw p 
	ON p.state = a.state
JOIN population_raw po 
    ON po.NAME = a.State
JOIN covid_master_table c 
    ON c.state = a.State
WHERE c.date >= '2021-01-01'  -- filter to post-vaccine release
	AND a.State IN ('WY', 'MS', 'LA', 'ID', 'TN', 'CT', 'MA', 'ME', 'RI', 'VT')
GROUP BY a.State, p.Dem_or_rep,  po.POPESTIMATE2021
ORDER BY max_vax_rate DESC;
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------



-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- VACCINE ADMINISTRATION RATES, DEATHS FOR THE 10 STATES OF INTEREST
SELECT 
    c.state,
    MAX(c.administered_Dose1_Pop_Pct) AS max_vax_rate,
    SUM(c.deaths_covid) / po.POPESTIMATE2021 * 100 AS percent_population_dead_post_vax
FROM covid_master_table c
JOIN population_raw po 
    ON po.NAME = c.state
WHERE c.date >= '2021-01-01'  -- only consider deaths after vaccine rollout
		AND c.State IN ('WY', 'MS', 'LA', 'ID', 'TN', 'CT', 'MA', 'ME', 'RI', 'VT')
GROUP BY c.state, po.POPESTIMATE2021
ORDER BY max_vax_rate DESC;
-- vaccinations vs deaths. 
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------
-- --------------------------------------------------------------------------------------------------------------------------------------------------------------------------